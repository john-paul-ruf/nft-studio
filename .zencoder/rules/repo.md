---
description: Repository Information Overview
alwaysApply: true
---

# NFT Studio Information

## Summary
NFT Studio is a desktop application built with Electron and React that serves as a front-end for the my-nft-gen library. It provides a graphical interface for creating, editing, and rendering NFT projects with various effects and configurations.

## Structure
- **src/**: Main application source code (React components, services, hooks)
- **tests/**: Comprehensive test suite with unit, integration, and regression tests
- **dist/**: Build output directory (generated by webpack)
- **icons/**: Application icons for different platforms
- **docs/**: Documentation files
- **scripts/**: Utility scripts

## Language & Runtime
**Language**: JavaScript/JSX (React)
**Version**: ES Modules (type: module)
**Build System**: Webpack 5
**Package Manager**: npm

## Dependencies
**Main Dependencies**:
- React 18.3.1
- React DOM 18.3.1
- Electron 30.0.6
- Material UI (@mui/material 7.3.2)
- my-nft-gen (local dependency)
- Radix UI components

**Development Dependencies**:
- Babel 7.24.5 (with React and env presets)
- Webpack 5.91.0 and webpack-cli 5.1.4
- Electron Builder 26.0.12
- CSS and Style loaders

## Build & Installation
```bash
# Install dependencies
npm install

# Development build and start
npm run start:dev

# Production build
npm run build

# Package application
npm run package       # All platforms
npm run package:mac   # macOS only
npm run package:win   # Windows only
npm run package:linux # Linux only
```

## Testing
**Framework**: Custom test runner with mock system
**Test Location**: tests/ directory with subdirectories for different test types
**Naming Convention**: *.test.js files
**Configuration**: tests/setup.js for global test configuration
**Run Command**:
```bash
# Run all tests
npm test

# Run specific test categories
npm run test:app
npm run test:canvas
npm run test:wizard
npm run test:services
npm run test:ipc

# Quick verification
npm run test:verify
```

## Application Structure
**Main Process**: main.js (Electron main process)
**Renderer Process**: render.js (React entry point)
**Preload Script**: preload.js (Secure IPC bridge)
**Entry Point**: src/App.jsx (Main React component)

## Architecture
**Pattern**: Event-driven architecture with IPC communication
**State Management**: Custom hooks and context providers
**IPC Bridge**: Secure contextBridge with exposed API methods
**Service Layer**: Dependency injection via ApplicationFactory
**UI Framework**: React with Material UI components

## Single Source of Truth Patterns

### ProjectState (Core State Management)
**Location**: `src/models/ProjectState.js`
**Purpose**: Central authority for all project data and state
**Key Responsibilities**:
- Maintains the complete project configuration
- Handles automatic resolution scaling when dimensions change
- Manages effects list with all properties and sub-effects
- Provides save/load functionality for .nftproject files
- Emits update events for UI synchronization

**Important Methods**:
- `setTargetResolution()` - Auto-scales all effects when resolution changes
- `setIsHorizontal()` - Auto-scales when orientation changes
- `getResolutionDimensions()` - Returns calculated width/height based on resolution and orientation
- `reorderEffects()` - Maintains effect order
- `update()` - Generic update method that triggers callbacks

### Resolution & Scaling System
**Single Source**: ProjectState manages all resolution/dimension calculations
**Auto-Scaling**: When resolution or orientation changes, ProjectState automatically:
1. Calculates new dimensions
2. Scales all effect properties proportionally
3. Updates nested effects (secondary, keyframe)
4. Notifies all subscribers of changes

**Key Files**:
- `src/models/ProjectState.js` - Core scaling logic
- `src/utils/ResolutionMapper.js` - Resolution presets and mappings
- `src/utils/ScalingUtilities.js` - Scaling calculation utilities

### Command Pattern & Undo/Redo
**Single Source**: `src/services/CommandService.js`
**Features**:
- Tracks up to 50 effect-related actions
- Filters out non-effect commands (resolution, orientation, frames)
- Provides detailed human-readable descriptions with effect IDs
- Supports undo/redo to any point in history

**Effect Commands** (tracked for undo/redo):
- `AddEffectCommand` - Add primary effects
- `DeleteEffectCommand` - Remove effects
- `UpdateEffectCommand` - Modify effect properties
- `ReorderEffectsCommand` - Drag & drop reordering
- `AddSecondaryEffectCommand` - Add secondary effects
- `AddKeyframeEffectCommand` - Add keyframe effects
- `DeleteSecondaryEffectCommand` - Remove secondary effects
- `DeleteKeyframeEffectCommand` - Remove keyframe effects
- `ReorderSecondaryEffectsCommand` - Reorder within parent
- `ReorderKeyframeEffectsCommand` - Reorder keyframes

### Color Scheme Management
**Single Source**: `src/services/PreferencesService.js`
**Storage**: User preferences file in app data directory
**Key Features**:
- Favorite color schemes
- Default color scheme selection
- Persistent storage across sessions
- Integration with ColorPicker components

### Event Bus Architecture
**Single Source**: `src/services/EventBusService.js`
**Purpose**: Decoupled communication between components
**Key Events**:
- `effect:*` - Effect-related actions
- `project:*` - Project management
- `resolution:*` - Resolution changes
- `orientation:*` - Orientation changes
- `command:*` - Undo/redo actions
- `renderloop:*` - Render control

### Effect Registry
**Single Source**: `src/main/services/EffectRegistryService.js`
**Purpose**: Central registry of all available effects
**Features**:
- Dynamic effect discovery
- Config class introspection
- Effect validation
- Preview generation
- Registry caching for faster startup (via RegistryCacheService)

### Registry Cache System
**Single Source**: `src/main/services/RegistryCacheService.js`
**Purpose**: Cache effect registry metadata to improve startup performance
**Key Features**:
- Caches core effects and plugin metadata
- Validates cache using checksums (detects plugin changes)
- Auto-invalidates on plugin install/uninstall
- Stores cache in `{userData}/registry-cache.json`
- Version-aware (invalidates on cache format changes)
**Performance Impact**:
- Reduces startup time by 50%+ when cache is valid
- Skips expensive effect discovery and registration
- Falls back to normal loading if cache is invalid

### Project Persistence
**Single Source**: ProjectState save/load methods
**File Format**: `.nftproject` (JSON-based)
**Key Data**:
- Complete project configuration
- All effects with properties
- Resolution and orientation settings
- Project metadata (name, artist, etc.)

## Important Patterns to Follow

1. **Never Directly Modify State** - Always use ProjectState methods
2. **Use Commands for User Actions** - All effect modifications should use Command pattern
3. **Event-Driven UI Updates** - Components subscribe to events, not direct callbacks
4. **Resolution Changes Auto-Scale** - Never manually scale effects; ProjectState handles it
5. **Effect IDs for Uniqueness** - All effects have unique IDs for tracking
6. **Single Update Flow**: User Action → Command → ProjectState → Event → UI Update
7. **Registry Cache for Performance** - EffectRegistryService uses caching; invalidate cache on plugin changes
8. **Dependency Injection via ServiceFactory** - All services accessed through ApplicationFactory singleton